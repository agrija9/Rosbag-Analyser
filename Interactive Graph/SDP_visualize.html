<!doctype html>
<html>
    <head>
    <title>Network</title>
    <script type="text/javascript" src="//unpkg.com/vis-timeline@latest/dist/vis-timeline-graph2d.min.js"></script>
    <link href="//unpkg.com/vis-timeline@latest/dist/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="styles.css">
    <style type="text/css">
        #mynetwork {
        width: 600px;
        height: 400px;
        border: 1px solid lightgray;
        }

        .box {
            display: inline-block;
            height: 20px;
            width: 20px;
            border: 1px solid;
        }
    </style>

    </head>

    <body>

        <h1>RosBag Reader</h1>

        <div id="visualization"></div>
        <p></p>
        <p>Legends.</p>
        <div id="legend"></div>

        <script type="text/javascript">
            
            var visdata = new vis.DataSet();

            chart(visdata);

            function month(m){
                if (m == "Jan"){
                    return "1"
                }else if (m == "Feb"){
                    return "2"
                }else if (m == "Mar"){
                    return "3"                    
                }else if (m == "Apr"){
                    return "4"                    
                }else if (m == "May"){
                    return "5"                    
                }else if (m == "Jun"){
                    return "6"                    
                }else if (m == "Jul"){
                    return "7"                    
                }else if (m == "Aug"){
                    return "8"                    
                }else if (m == "Sep"){
                    return "9"                    
                }else if (m == "Oct"){
                    return "10"                    
                }else if (m == "Nov"){
                    return "11"                    
                }else {
                    return "12"                    
                }
            }
            
            async function getData(visdata){
                visdata.clear(); 
                const response = await fetch('Rosbag_Content.csv');
                const data = await response.text();
                const table = data.split('\n').slice(1,-1);
                var labels = {};
                table.forEach(row => {
                    const mySubString = row.match(/"(.*?)"/);
                    const Day = mySubString[1].substring(0, 3);
                    const Dat = parseInt(mySubString[1].substring(5, 7));
                    const Month = parseInt(month(mySubString[1].substring(8, 11)));
                    const Year = parseInt(mySubString[1].substring(12, 16));
                    const Hour = parseInt(mySubString[1].substring(17, 19));
                    const Min = parseInt(mySubString[1].substring(20, 22));
                    const Sec = parseInt(mySubString[1].substring(23, 25));
                    const Nsec = parseInt(mySubString[1].substring(26, ));
                    const Msec = parseInt(Nsec/Math.pow(10, 6));
                    const DateTime = new Date(Year, Month, Dat, Hour, Min, Sec, Msec);
                    const col = row.split(',');
                    const Topic = col[2];
                    const Msg = col[3];
                    const Color = col[4];
                    const Title = '<table border="1"><tr><td>Topic : '+ Topic + '</td></tr><tr><td>Message : ' + Msg + '</td></tr><tr><td>Timestamp : ' + mySubString[1] + '</td></tr></table>';
                    var items = [{start:DateTime, content: "", className: Color, title: Title}];
                    labels[Topic] = Color;
                    visdata.add(items);
                });
                colorize(labels);
                return visdata;
            }
            var options = {
                editable: true
            };

            // var colorList = {t1: 'red', t2: 'green', t3: 'blue'};

            function colorize(colorList) {
                var container = document.getElementById('legend');
            
                for (var key in colorList) {
                    var boxContainer = document.createElement("DIV");
                    var box = document.createElement("DIV");
                    var label = document.createElement("SPAN");

                    label.innerHTML = key;
                    box.className = "box";
                    box.style.backgroundColor = colorList[key];

                    boxContainer.appendChild(box);
                    boxContainer.appendChild(label);

                    container.appendChild(boxContainer);

                }
            }

            

            async function chart(visdata){
                var actual_data = await getData(visdata);
                // create the timeline
                var container = document.getElementById("visualization");
                timeline = new vis.Timeline(container, actual_data, options);
            }
        </script>

    </body>
</html>